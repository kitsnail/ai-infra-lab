# vLLM 性能测试原始数据

## 测试环境

- **硬件平台**: B200×8
- **模型**: Qwen3-VL-235B-A22B-Instruct
- **并发数**: 64
- **总请求数**: 1000
- **测试时间**: 2025-12-02

## 测试结果汇总

### Test 1: 基线配置
```bash
--tensor-parallel-size 4
--max-model-len 262144
--enable-chunked-prefill
--max-num-batched-tokens 131072
--enforce-eager
--gpu-memory-utilization 0.85
--max-num-seqs 64
```

**性能指标**:
- 吞吐量: 805.4 tok/s
- 请求吞吐: 10.39 req/s
- 平均延迟: 6.05s
- P50延迟: 5.10s
- P95延迟: 14.73s

### Test 2: 异步调度
```bash
# 基线 + --async-scheduling
```

**性能指标**:
- 吞吐量: 786.5 tok/s (-2.3%)
- 请求吞吐: 10.18 req/s
- 平均延迟: 6.08s
- P50延迟: 5.05s
- P95延迟: 16.08s

### Test 3: FP8 KV-Cache
```bash
# 基线 + --kv-cache-dtype "fp8"
```

**性能指标**:
- 吞吐量: 774.9 tok/s (-3.8%)
- 请求吞吐: 9.63 req/s
- 平均延迟: 6.47s
- P50延迟: 5.39s
- P95延迟: 14.35s

### Test 4: FP8 + BF16 + Eager
```bash
# 基线 + --kv-cache-dtype "fp8" + --dtype bfloat16 + --enforce-eager
```

**性能指标**:
- 吞吐量: 777.4 tok/s (-3.5%)
- 请求吞吐: 9.65 req/s
- 平均延迟: 6.43s
- P50延迟: 5.50s
- P95延迟: 14.40s

### Test 5: 优化配置
```bash
--tensor-parallel-size 4
--max-model-len 262144
--enable-chunked-prefill
--max-num-batched-tokens 131072
--gpu-memory-utilization 0.85
--max-num-seqs 64
--dtype bfloat16
--kv-cache-dtype "fp8"
# 移除 --enforce-eager
```

**性能指标**:
- 吞吐量: 1965.8 tok/s (+144%)
- 请求吞吐: 24.13 req/s
- 平均延迟: 2.62s
- P50延迟: 1.51s
- P95延迟: 17.66s

### Test 6: 优化配置验证
```bash
# 同Test 5配置
```

**性能指标**:
- 吞吐量: 1982.4 tok/s (+146%)
- 请求吞吐: 24.55 req/s
- 平均延迟: 2.57s
- P50延迟: 1.42s
- P95延迟: 17.33s

## 详细百分位数据

### 延迟分布对比 (TTFT - Time to First Token)

| 百分位 | Test 1 | Test 2 | Test 3 | Test 4 | Test 5 | Test 6 |
|--------|--------|--------|--------|--------|--------|--------|
| P10 | 4.78s | 4.73s | 5.14s | 5.06s | **1.32s** | **1.30s** |
| P25 | 4.90s | 4.90s | 5.23s | 5.18s | **1.40s** | **1.35s** |
| P50 | 5.10s | 5.05s | 5.39s | 5.50s | **1.51s** | **1.42s** |
| P66 | 5.19s | 5.16s | 5.60s | 5.70s | **1.60s** | **1.53s** |
| P75 | 5.24s | 5.27s | 5.80s | 5.81s | **1.66s** | **1.61s** |
| P80 | 5.30s | 5.33s | 5.93s | 5.99s | **1.70s** | **1.70s** |
| P90 | 5.50s | 5.71s | 6.84s | 6.41s | **2.22s** | **1.90s** |
| P95 | 14.73s | 16.08s | 14.35s | 14.40s | 17.66s | 17.33s |
| P98 | 24.89s | 26.76s | 24.80s | 25.83s | 19.31s | 19.80s |
| P99 | 24.89s | 26.76s | 24.80s | 25.83s | 19.34s | 19.80s |

## 吞吐量对比

| 指标 | Test 1 | Test 2 | Test 3 | Test 4 | Test 5 | Test 6 |
|------|--------|--------|--------|--------|--------|--------|
| 输出吞吐 (tok/s) | 660.0 | 644.1 | 640.1 | 642.4 | **1628.0** | **1638.7** |
| 总吞吐 (tok/s) | 805.4 | 786.5 | 774.9 | 777.4 | **1965.8** | **1982.4** |
| 请求吞吐 (req/s) | 10.39 | 10.18 | 9.63 | 9.65 | **24.13** | **24.55** |

## 输入输出特征

| 测试 | 平均输入tokens | 平均输出tokens | 输出/输入比 |
|------|---------------|---------------|------------|
| Test 1 | 14 | 63.5 | 4.54 |
| Test 2 | 14 | 63.3 | 4.52 |
| Test 3 | 14 | 66.5 | 4.75 |
| Test 4 | 14 | 66.6 | 4.76 |
| Test 5 | 14 | 67.5 | 4.82 |
| Test 6 | 14 | 66.8 | 4.77 |

## 关键发现

1. **性能突破点**: 移除 `--enforce-eager` 参数使性能提升 144-146%
2. **延迟改善**: P50延迟从 5.1s 降至 1.4s (降低 73%)
3. **吞吐量跃升**: 从 805 tok/s 提升至 1982 tok/s (提升 146%)
4. **并发处理能力**: 请求处理能力从 10 req/s 提升至 24+ req/s
